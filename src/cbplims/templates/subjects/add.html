{% extends "settings/layout.html" %}
{% block adminbody %}

  <h2>Adding Subjects</h2>
 <br>
  
 

<hr>
  <form action="/subjects/add" method="POST" enctype="multipart/form-data">
    <table>
        <tr>
            <td> Name </td> <td> <input type="text" name="name" id="name" ></td>
        </tr>
        
        <tr><td>Choose a Project</td>
      
        <td>
        <select name = "project">  
             {% for p in projects %}
          <option value="{{p.id}}">
          {{p.name}} :: {{p.code}}
          </option>
          {% endfor %}
        </select>
        </td></tr>
        
        <tr><td>Choose a Subject Type</td>
      
        <td>
        <select name = "subject_types" id="subject_types" >
          <option value="">Select</option>
             {% for st in subject_types %}
          <option value="{{st.id}}">
          {{st.name}}
          </option>
          {% endfor %}
        </select>
        </td></tr>
        
  
        
        <tr>
            <td>notes</td>
            <td><textarea rows="4" cols="50" name = "notes"></textarea> </td>
        </tr>
      
  
     <tr>
          <td> Extra </td>
          <td>
            <div id="extra" name="extra">
              
            </div>
          </td>
    </tr>
  
    <tr><td>&nbsp; </td><td><br><input type="submit" value="Add Subject"/></td></tr>
    </table>
    

{% for st in subject_types %}
              {% if st.data %}
              <div id="q1_{{st.id}}" name="q1_{{st.id}}">
              <hr><b>Extra fields for {{st.name}} <br><br></b>
              <table class="list" border=1>
                <tr>
                  <th>Name</th>
                  <th>Description</th>
                  <th>Value</th>
                </tr> 
              
              {% for i in st.data %}
              <tr>
                <td>{{st.data[i].name}}</td>
                <td>{{st.data[i].description}}</td>
                
              {% if st.data[i].type == "file" %}
                <td><input type="file" name="{{st.id}}_file_{{i}}" id="{{st.id}}_file_{{i}}"></td> 
              {% elif st.data[i].type == "date_full" %}
                <td><input type="date" name="{{st.id}}_extra_{{i}}" id="{{st.id}}_extra_{{i}}" class="textb"></td>
              {% elif st.data[i].type == "date_year" %}
                <td><input type="number" min="1900" max="2999" name="{{st.id}}_extra_{{i}}" id="{{st.id}}_extra_{{i}}" class="textb"></td>
              {% elif st.data[i].type == "enum" %}
                  {% set list1 = st.data[i].enum.split(',') %}
                   <td> 
                  <select name = "{{st.id}}_extra_{{i}}" id="{{st.id}}_extra_{{i}}" class="textb">
                  {% for x in list1 %}
                  <option value="{{x}}"> {{x}} </option>    
                  {% endfor %}
                  </select>
                   </td>
              {% elif st.data[i].type == "binary" %}
                <td>Yes <input type="radio" name="{{st.id}}_extra_{{i}}" id="{{st.id}}_extra_{{i}}" value="yes">
                No <input type="radio" name="{{st.id}}_extra_{{i}}" id="{{st.id}}_extra_{{i}}" value="no">
                 </td>
              {% else %}
              <td><input type="{{st.data[i]}}" name="{{st.id}}_extra_{{i}}" id="{{st.id}}_extra_{{i}}" class="textb"></td>
              </tr>
              {% endif %}
              {% endfor %}
              </table>
              </div>
              {% endif %}
              {% endfor %}
              

<script type="text/javascript">
  
  function hideAll (){
    
 // hide all extra fields 
  var inputs = document.getElementsByTagName("div");
  for (x = 0 ; x < inputs.length ; x++){
    myname = inputs[x].getAttribute("name");
    
    if (myname !== null && myname.indexOf("q1_") >= 0){
     document.getElementById(myname).style.visibility = "hidden";
    }
    
    
  }
  } // end hide fucntion
  hideAll()
// end hiding
// now unhide extra fields but only for the ones where the user selects.

document.getElementById("subject_types").onchange = function(e) {
  var i = "q1_"+this[this.selectedIndex].value;
  
  document.getElementById("extra").innerHTML = document.getElementById(i).innerHTML
  console.log(i);
};



    </script>

  
{% endblock %}