{% extends "settings/layout.html" %}
{% block adminbody %}
<script src="//code.jquery.com/jquery-1.10.2.js"></script>
  <h2>View Subject {{subject.name}} </h2>
<div class="msg">{{msg}}</div>

<br>

<b>ID:</b> {{subject.id}} <br>
<b>Project:</b> {{subject.project_name}} <br>
<b>Notes:</b> {{subject.notes}} <br>
<a href="./edit"> Edit {{subject.name}}</a>
<form method="POST" action="/subjects/{{subject.id}}/delete_diagnosis">
<hr><b>Diagnosis</b> <br>

    <div style="float:left;">
      <input type="submit" name="method" value="Delete"/>
    </div>
    
    <div style="float:right;">
      <input type="button" name="method" value="Add Diagnosis" onclick="location.href='/subjects/{{subject.id}}/add_diagnosis'"/>
    </div>
    
<table border="0" class="list">
{% for d in diagnoses %}
<tr bgcolor="#C3C8C9"><td>{{d.diagnosis_name}}</td> <td><input type="checkbox" name="diagnosis_ids" value="{{d.diagnosis_id}}"> </td> </tr>
<tr><td>Is this primary?</td><td>{{d.diagnosis_is_primary}} </td></tr>
<tr><td>Days from primary:</td><td>{{d.diagnosis_days_from_primary}} </td></tr>
<tr><td>Diagnosis recorded by:</td> <td>{{d.diagnosis_recorded_by}} </td></tr>
<tr><td>Diagnosis recorded date:</td> <td>{{d.diagnosis_recorded_date}} </td></tr>

{% endfor %}


</table>

</form>


<hr><b>Research Studies</b><br>
<form method="POST" action="/subjects/{{subject.id}}/delete_study">
    <div style="float:left;">
      <input type="submit" name="method" value="Delete"/>
    </div>
    
    <div style="float:right;">
      <input type="button" name="method" value="Add Study" onclick="location.href='/subjects/{{subject.id}}/add_study'"/>
    </div>

<table border="0" class="list">
{% for ss in subject_study %}
<tr bgcolor="#A8A0A1"><td>{{ss.research_study_name}} </b></td> <td><input type="checkbox" name="study_ids" value="{{ss.research_study_study_id}}"> </td> </tr>
<tr><td>Research Study recorded by:</td><td> {{ss.research_study_username}} </td></tr>
<tr><td>Research Study date:</td><td> {{ss.research_study_date}} </td></tr>
{% endfor %}
</table>

<table>
<tr bgcolor="#80aaff">
    <td>Extra info</td><td></td></tr>
    <tr>
    <td>
        <div id= "og">
            
            {% if subject.data %}
            <table class="list" border="1">
                <tr><th>Name</th><th>Value</th></tr>
              {% for i in subject.data%}
                <tr>
                {% if subject.data[i].mime %}
                     {% if 'image' in subject.data[i].mime %}
                        <td><a href="./link?id={{i}}">{{subject.data[i].filename}}</a></td> 
                        <td><img src="data:image;base64,{{subject.data[i].base64}}" height="100" width="100"> </tr>
                        
                     {% else %}
                         <td>{{subject.data[i].mime}}</td>
                         <td><a href="./link?id={{i}}">{{subject.data[i].filename}}</a></td> 
                     {% endif %}
                {% else %}
                    <td>{{subject.subject_types_data[i].name}} </td> <td>{{subject.data[i]}} </td>
                {% endif %}
                </tr>
              {% endfor %}
              </table>
            {% endif %}
            
              </div>
        
    </td>
</tr>
</table>

</form>
<hr>
<a href="../../samples/{{subject.id}}/add_from_subject"> ADD Sample</a>
<hr>
<h2>View Samples </h2>
<table class="list">
<tr><th>Sample Name</th><th>Sample ID</th><th>Barcode</th><th>Date</th><th>Location</th><th>Notes</th><th>Extra</th></tr>    
{% for s in samples %}
<tr>
    <td>{{s.name}}</td>
    <td>{{s.id}}</td>
    <td>{{s.barcode}}</td>
    <td>{{s.date_collection}}</td>
    <td>{{s.location_id}}</td>
    <td>{{s.notes}}</td>
    <td><a href="javascript:toggleDiv('d_{{s.id}}');">extra</a></td>
</tr>
<tr>
    <td colspan="6">
        <div id="d_{{s.id}}" name="d_{{s.id}}" class="hExtra">
            
             {% if s.extra %}
            <table class="list" border="1">
                <tr><th>Name</th><th>Value</th></tr>
              {% for i in s.extra%}
                <tr>
                {% if s.extra[i].mime %}
                     {% if 'image' in s.extra[i].mime %}
                        <td><a href="./link?id={{i}}">{{s.extra[i].filename}}</a></td> 
                        <td><img src="data:image;base64,{{s.extra[i].base64}}" height="100" width="100"> </tr>
                        
                     {% else %}
                         <td>{{s.extra[i].mime}}</td>
                         <td><a href="./link?id={{i}}">{{s.extra[i].filename}}</a></td> 
                     {% endif %}
                {% else %}
                    <td>{{s.sample_types_data[i].name}} </td> <td>{{s.extra[i]}} </td>
                {% endif %}
                
                </tr>
              {% endfor %}
              </table>
            {% endif %}
            
        </div>
   
    </td>
</tr>
{% endfor %} <!-- end samples !--> 
    
</table>


<script text="text/javascript">
    $('.hExtra').hide();
    
   function toggleDiv(divId) {
    $('.hExtra').hide();
      $("#"+divId).toggle();
   }
 </script>

{% endblock %}